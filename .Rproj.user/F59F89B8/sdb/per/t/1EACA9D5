{
    "contents" : "library(\"plyr\")\n\n\nLT<-read.table(\"LT.prop\")\nrest<-read.table(\"Rest.prop\")\n\n# remove villages where resting collection data not available\nLT2<-LT[!LT$Village %in% c(\"1\",\"2\",\"9\"),]\nLT3<-LT2[,c(\"Village\",\"Species\",\"Sum\",\"Tot\",\"Prop\")]\nnames(LT3)<-c(\"Village\",\"Species_name\",\"Sum\",\"Tot\",\"Prop\")\n\nOR.func<-function(spp,dat1=rest,dat2=LT3){\n  rest2<-subset(rest,Species==spp)\n  rest3<-ddply(rest2,.(),transform,minus=Tot-Sumspp)\n  LT<-subset(dat2,Species_name==spp)\n  names(LT)<-c(\"LTVillage\",\"LTSpecies\",\"LTSumspp\",\"LTTot\",\"LTProp\")\n  LT2<-ddply(LT,.(),transform,LTminus=LTTot-LTSumspp)\n  both<-cbind.data.frame(LT2,rest3)\n  # OR = successes1 x failures2 / successes2 x failures1\n  ORa<-ddply(both,.(Village),transform,numer=LTSumspp*minus)\n  ORb<-ddply(ORa,.(Village),transform,denom=Sumspp*LTminus)\n  OR<-ddply(ORb,.(Village),transform,ORLT.rest=numer/denom)\n  OR2<-ddply(OR,.(Village),transform,ORrest.LT=denom/numer)\n  OR3<-ddply(OR2,.(Village),transform,logOR.LT.rest=log(ORLT.rest),logOR.rest.LT=log(ORrest.LT))\n  #SE of lnOR = sqrt(1/a + 1/b + 1/c + 1/d) 95% CI for lnOR= lnOR +/1 1.96*SE\n  OR4<-ddply(OR3,.(Village),transform, SE=sqrt(1/Sumspp + 1/LTSumspp + 1/LTminus + 1/minus))\n  OR5<-ddply(OR4,.(Village),transform,CIL=logOR.LT.rest-1.96*SE,CIH=logOR.LT.rest+1.96*SE)\n  OR6<-ddply(OR5,.(Village),transform,ORCIL=exp(CIL),ORCIH=exp(CIH))\n  return(OR6)\n}\n\ntritae.OR<-OR.func(spp=\"Culex Culex tritaeniorhynchus\")\npsv.OR<-OR.func(spp=\"Culex Culex pseudovishnui\")\ngel.OR<-OR.func(spp=\"Culex Culex gelidus\")\n\n# other common spp but that were not found in all villages\npedi<-subset(rest,Species==\"Anopheles Anopheles peditaeniatus\")\npediLT<-subset(LT3,Species_name==\"Anopheles Anopheles peditaeniatus\")\n\n# no pedi caught in resting in villages 3, 5 and 7\npedi.4<-pedi[1,]\npedi.6<-pedi[2,]\npedi.8<-pedi[3,]\npedi.10<-pedi[4,]\n\npedi[1,]<-c(3,\"Anopheles Anopheles peditaeniatus\",0,109,0)\npedi[2,]<-pedi.4\npedi[3,]<-c(5,\"Anopheles Anopheles peditaeniatus\",0,111,0)\npedi[4,]<-pedi.6\npedi[5,]<-c(7,\"Anopheles Anopheles peditaeniatus\",0,59,0)\npedi[6,]<-pedi.8\npedi[7,]<-pedi.10\npedi$Tot<-as.numeric(pedi$Tot)\npedi$Sumspp<-as.numeric(pedi$Sumspp)\n\nnames(pediLT)<-c(\"Village\",\"Species\",\"LTsum\",\"LTtot\",\"LTprop\")\npedi.both<-cbind.data.frame(pediLT,pedi)\n\npedi.both2<-ddply(pedi.both,.(Village),transform, LTminus=LTtot-LTsum,minus=Tot-Sumspp)\npedi.both3<-ddply(pedi.both2,.(Village),transform, numer=LTsum*minus,denom=Sumspp*LTminus)\npedi.OR<-ddply(pedi.both3,.(Village),transform, ORLT.rest=numer/denom)\np.OR3<-ddply(pedi.OR,.(Village),transform,logOR.LT.rest=log(ORLT.rest))\np.OR4<-ddply(p.OR3,.(Village),transform, SE=sqrt(1/Sumspp + 1/LTsum + 1/LTminus + 1/minus))\np.OR5<-ddply(p.OR4,.(Village),transform,CIL=logOR.LT.rest-1.96*SE,CIH=logOR.LT.rest+1.96*SE)\np.OR6<-ddply(p.OR5,.(Village),transform,ORCIL=exp(CIL),ORCIH=exp(CIH))\n\n# Armigeres subalbatus\nAr.sub<-subset(rest,Species==\"Armigeres Armigeres subalbatus\")\nAr.3<-Ar.sub[1,]\nAr.5<-Ar.sub[2,]\nAr.6<-Ar.sub[3,]\nAr.7<-Ar.sub[4,]\nAr.8<-Ar.sub[5,]\nAr.10<-Ar.sub[6,]\n\nAr.sub[1,]<-Ar.3\nAr.sub[2,]<-c(4,\"Armigeres Armigeres subalbatus\",0,50,0)\nAr.sub[3,]<-Ar.5\nAr.sub[4,]<-Ar.6\nAr.sub[5,]<-Ar.7\nAr.sub[6,]<-Ar.8\nAr.sub[7,]<-Ar.10\nAr.sub$Tot<-as.numeric(Ar.sub$Tot)\nAr.sub$Sumspp<-as.numeric(Ar.sub$Sumspp)\n\nAr.subLT2<-subset(LT3,Species_name==\"Armigeres Armigeres subalbatus\")\nnames(Ar.subLT2)<-c(\"Village\",\"Species\",\"LTsum\",\"LTtot\",\"LTprop\")\n\nAr.subboth<-cbind.data.frame(Ar.subLT2,Ar.sub)\n\na.both2<-ddply(Ar.subboth,.(Village),transform, LTminus=LTtot-LTsum,minus=Tot-Sumspp)\na.both3<-ddply(a.both2,.(Village),transform, numer=LTsum*minus,denom=Sumspp*LTminus)\na.OR<-ddply(a.both3,.(Village),transform, ORLT.rest=numer/denom)\na.OR3<-ddply(a.OR,.(Village),transform,logOR.LT.rest=log(ORLT.rest))\n#SE of lnOR = sqrt(1/a + 1/b + 1/c + 1/d) 95% CI for lnOR= lnOR +/1 1.96*SE\na.OR4<-ddply(a.OR3,.(Village),transform, SE=sqrt(1/Sumspp + 1/LTsum + 1/LTminus + 1/minus))\na.OR5<-ddply(a.OR4,.(Village),transform,CIL=logOR.LT.rest-1.96*SE,CIH=logOR.LT.rest+1.96*SE)\na.OR6<-ddply(a.OR5,.(Village),transform,ORCIL=exp(CIL),ORCIH=exp(CIH))\n\n# Culex vishnui\nvish<-subset(rest,Species==\"Culex Culex vishnui\")\nvish.3<-vish[1,]\nvish.4<-vish[2,]\nvish.5<-vish[3,]\nvish.7<-vish[4,]\n\nvish[1,]<-vish.3\nvish[2,]<-vish.4\nvish[3,]<-vish.5\nvish[4,]<-c(6,\"Culex Culex vishnui\",0,94,0)\nvish[5,]<-vish.7\nvish[6,]<-c(8,\"Culex Culex vishnui\",0,74,0)\nvish[7,]<-c(10,\"Culex Culex vishnui\",0,78,0)\nvish$Tot<-as.numeric(vish$Tot)\nvish$Sumspp<-as.numeric(vish$Sumspp)\n\nvishLT2<-subset(LT3,Species_name==\"Culex Culex vishnui\")\nnames(vishLT2)<-c(\"Village\",\"Species\",\"LTsum\",\"LTtot\",\"LTprop\")\n\nvishboth<-cbind.data.frame(vishLT2,vish)\nv.both2<-ddply(vishboth,.(Village),transform, LTminus=LTtot-LTsum,minus=Tot-Sumspp)\nv.both3<-ddply(v.both2,.(Village),transform, numer=LTsum*minus,denom=Sumspp*LTminus)\nv.OR<-ddply(v.both3,.(Village),transform, ORLT.rest=numer/denom)\nv.OR3<-ddply(v.OR,.(Village),transform,logOR.LT.rest=log(ORLT.rest))\nv.OR4<-ddply(v.OR3,.(Village),transform, SE=sqrt(1/Sumspp + 1/LTsum + 1/LTminus + 1/minus))\nv.OR5<-ddply(v.OR4,.(Village),transform,CIL=logOR.LT.rest-1.96*SE,CIH=logOR.LT.rest+1.96*SE)\nv.OR6<-ddply(v.OR5,.(Village),transform,ORCIL=exp(CIL),ORCIH=exp(CIH))\n\n# Armigeres kesseli\nAr.kess<-subset(rest,Species==\"Armigeres Armigeres kesseli\")\nAr.k3<-Ar.kess[1,]\nAr.k6<-Ar.kess[2,]\nAr.k7<-Ar.kess[3,]\nAr.k8<-Ar.kess[4,]\nAr.k10<-Ar.kess[5,]\n\nAr.kess[1,]<-Ar.k3\nAr.kess[2,]<-c(4,\"Armigeres Armigeres kesseli\",0,50,0)\nAr.kess[3,]<-c(5,\"Armigeres Armigeres kesseli\",0,50,0)\nAr.kess[4,]<-Ar.k6\nAr.kess[5,]<-Ar.k7\nAr.kess[6,]<-Ar.k8\nAr.kess[7,]<-Ar.k10\nAr.kess$Tot<-as.numeric(Ar.kess$Tot)\nAr.kess$Sumspp<-as.numeric(Ar.kess$Sumspp)\n\nAr.kessLT2<-subset(LT3,Species_name==\"Armigeres Armigeres kesseli\")\nnames(Ar.kessLT2)<-c(\"Village\",\"Species\",\"LTsum\",\"LTtot\",\"LTprop\")\n\nAr.kL3<-Ar.kessLT2[1,]\nAr.kL5<-Ar.kessLT2[2,]\nAr.kL6<-Ar.kessLT2[3,]\nAr.kL7<-Ar.kessLT2[4,]\nAr.kL8<-Ar.kessLT2[5,]\nAr.kL10<-Ar.kessLT2[6,]\n\nAr.kessLT2[1,]<-Ar.k3\nAr.kessLT2[2,]<-c(4,\"Armigeres Armigeres kesseli\",0,50,0)\nAr.kessLT2[3,]<-Ar.kL5\nAr.kessLT2[4,]<-Ar.kL6\nAr.kessLT2[5,]<-Ar.kL7\nAr.kessLT2[6,]<-Ar.kL8\nAr.kessLT2[7,]<-Ar.kL10\nAr.kessLT2$LTtot<-as.numeric(Ar.kessLT2$LTtot)\nAr.kessLT2$LTsum<-as.numeric(Ar.kessLT2$LTsum)\n\nAr.kessboth<-cbind.data.frame(Ar.kessLT2,Ar.kess)\n\nak.both2<-ddply(Ar.kessboth,.(Village),transform, LTminus=LTtot-LTsum,minus=Tot-Sumspp)\nak.both3<-ddply(ak.both2,.(Village),transform, numer=LTsum*minus,denom=Sumspp*LTminus)\nak.OR<-ddply(ak.both3,.(Village),transform, ORLT.rest=numer/denom)\nak.OR3<-ddply(ak.OR,.(Village),transform,logOR.LT.rest=log(ORLT.rest))\nak.OR4<-ddply(ak.OR3,.(Village),transform, SE=sqrt(1/Sumspp + 1/LTsum + 1/LTminus + 1/minus))\nak.OR5<-ddply(ak.OR4,.(Village),transform,CIL=logOR.LT.rest-1.96*SE,CIH=logOR.LT.rest+1.96*SE)\nak.OR6<-ddply(ak.OR5,.(Village),transform,ORCIL=exp(CIL),ORCIH=exp(CIH))\n\ntiff(\"Fig2.tiff\", height = 3, width = 2, units = 'in', compression=\"lzw\", res=400)\n\n# Plotting \npar(mai=c(1.5,1.5,1.5,2),mar=c(1.5,1.5,1.5,2),oma=c(2,1.5,0,0),mfrow=c(4,2),cex=0.5)\nplot.or<-function(dat,species){\n  nr<-nrow(dat)\n  plot(dat$logOR.LT.rest,1:nr,type=\"n\",xlim=c(-6,6),main=species,yaxt=\"n\",bty=\"n\",cex.main=0.6, cex.axis=0.5)\n  points(x=dat$logOR.LT.rest,y=1:nr,pch=20,col=\"blue\",cex=0.5)\n  abline(v=0)\n  segments(dat$CIH, 1:nr, dat$CIL,1:nr,lwd=0.5)\n  ylabels<-c(1,2,3,4,5,6,8)\n  axis(2, 1:nr, ylabels,cex.axis=0.5)\n  mtext(\"Method 2\",side=3,line=0,cex=0.2,at=4)\n  mtext(\"Method 1\",side=3,line=0,cex=0.2,at=-5)\n}\n\nplot.or(dat=tritae.OR,species=expression(paste(italic(\"Cx. tritaeniorhynchus\"))))\nplot.or(psv.OR,species=expression(paste(italic(\"Cx. pseudovishnui\"))))\nplot.or(gel.OR,species=expression(paste(italic(\"Cx. gelidus\"))))\nplot.or(p.OR6,species=expression(paste(italic(\"An. peditaeniatus\"))))\nplot.or(a.OR6,species=expression(paste(italic(\"Ar. subalbatus\"))))\nplot.or(v.OR6,species=expression(paste(italic(\"Cx. vishnui\"))))\nplot.or(ak.OR6,species=expression(paste(italic(\"Ar. kesseli\"))))\n\nmtext(\"Log odds ratio (method 2: method 1) and 95% CI\",side=1,outer=T,line=1,cex=0.4)\nmtext(\"Village\",side=2,outer=T,line=0,cex=0.4)\n\ndev.off()\n",
    "created" : 1443440285676.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1843573939",
    "id" : "1EACA9D5",
    "lastKnownWriteTime" : 1443440442,
    "path" : "~/GitHub/mosquito-Rajshahi/fig2.R",
    "project_path" : "fig2.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}